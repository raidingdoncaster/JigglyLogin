{% extends "live_events/base.html" %}

{% macro action_button(button, variant="primary") -%}
  {%- if button and button.label and button.href -%}
    {%- set kind = button.variant if button.variant else variant -%}
    <a
      class="button button--{{ kind }} button--inline"
      href="{{ button.href }}"
      {% if button.new_tab %}target="_blank" rel="noopener"{% endif %}
    >
      {{ button.label }}
    </a>
  {%- endif -%}
{%- endmacro %}

{% block content %}
  {% set agenda = content.get("agenda") or {} %}
  <section>
    {% set banner = agenda.get("banner") %}
    {% if banner and banner.image %}
      <div class="banner">
        <img src="{{ url_for('static', filename=banner.image) }}" alt="{{ banner.alt or '' }}">
      </div>
    {% endif %}

    {% set welcome = agenda.get("welcome") or {} %}
    <div class="welcome-card">
      {% if welcome.eyebrow %}
        <div class="eyebrow">{{ welcome.eyebrow }}</div>
      {% endif %}
      <h1>{{ welcome.title or "Community Celebrations Hub" }}</h1>
      {% if welcome.subtitle %}
        <p class="lead">{{ welcome.subtitle }}</p>
      {% endif %}
      {% if welcome.image %}
        <div class="welcome-card__image">
          <img src="{{ url_for('static', filename=welcome.image) }}" alt="{{ welcome.alt or '' }}">
        </div>
      {% endif %}
    </div>

    {% set cards = agenda.get("cards") or [] %}
    {% if cards %}
      {% if agenda.highlights_heading %}
        <h2 style="margin-top:36px;">{{ agenda.highlights_heading }}</h2>
      {% endif %}
      <div class="agenda-grid">
        {% for card in cards if card %}
          <article class="agenda-card">
            {% if card.image %}
              <div class="agenda-card__image">
                <img src="{{ url_for('static', filename=card.image) }}" alt="{{ card.alt or '' }}">
              </div>
            {% endif %}
            {% if card.time %}
              <span class="agenda-card__time">{{ card.time }}</span>
            {% endif %}
            {% if card.title %}
              <div class="agenda-card__title">{{ card.title }}</div>
            {% endif %}
            {% if card.body %}
              <p class="agenda-card__body">{{ card.body }}</p>
            {% endif %}
            {% if card.cta %}
              <div class="agenda-card__cta">
                {{ action_button(card.cta, "primary") }}
              </div>
            {% endif %}
          </article>
        {% endfor %}
      </div>
    {% endif %}

    {% set tours = agenda.get("route_tours") or {} %}
    {% if tours %}
      <div class="route-tours">
        {% if tours.heading %}
          <h2>{{ tours.heading }}</h2>
        {% endif %}
        {% if tours.description %}
          <p class="lead">{{ tours.description }}</p>
        {% endif %}
        <div class="tour-grid">
          {% set left_times = tours.get("times_left") or [] %}
          {% set right_times = tours.get("times_right") or [] %}
          {% if left_times %}
            <div class="tour-column">
              {% for t in left_times %}
                <div class="tour-slot">{{ t }}</div>
              {% endfor %}
            </div>
          {% endif %}
          {% if right_times %}
            <div class="tour-column">
              {% for t in right_times %}
                <div class="tour-slot">{{ t }}</div>
              {% endfor %}
            </div>
          {% endif %}
        </div>
      </div>
    {% endif %}
  </section>
{% endblock %}
