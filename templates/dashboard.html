{% extends "base.html" %}
{% block content %}

<div style="max-width: 700px; margin: auto;">

    <!-- Top Section -->
    <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
        <div style="position: relative; display: inline-block;">
            <img src="{{ url_for('static', filename='avatars/' + avatar) }}"
                 alt="Avatar"
                 style="width: 80px; height: 80px; border-radius: 50%; border: 3px solid #3a8dde; object-fit: cover; box-shadow: 0 0 8px rgba(58,141,222,0.6);">

            <!-- Edit button -->
            <a href="{{ url_for('change_avatar') }}"
               style="position: absolute; bottom: 0; right: 0; background: #fff; border-radius: 50%; padding: 6px; border: 1px solid #ccc; font-size: 14px; text-decoration: none;">
                ‚úèÔ∏è
            </a>
        </div>

        <div>
            <h2 style="margin: 0;">Welcome, {{ trainer }}!</h2>
            <p style="margin: 4px 0; font-size: 0.9em; color: #555;">
                <strong>Account Type:</strong>
                {% if account_type == "Kids Account" %}
                    üë∂ Kids Account
                {% else %}
                    Standard Account
                {% endif %}
            </p>
            {% if campfire_username and campfire_username != "Kids Account" %}
            <p style="margin: 0; font-size: 0.9em; color: #555;">
                <strong>Campfire Username:</strong> {{ campfire_username }}
            </p>
            {% endif %}
            {% if last_login %}
            <p style="margin: 0; font-size: 0.8em; color: #888;">
                Last login: {{ last_login }}
            </p>
            {% endif %}
        </div>
    </div>

    <!-- Main navigation buttons -->
    <p style="text-align: center; margin-bottom: 1.5em;">Choose an option below:</p>

    <div style="display: grid; grid-template-columns: 1fr; gap: 15px;">
        <a href="{{ url_for('passport') }}"
           style="display: block; padding: 15px; background: #3a8dde; color: white; text-align: center; font-weight: 600; border-radius: 8px; text-decoration: none; box-shadow: 0 2px 6px rgba(0,0,0,0.15);">
           üéüÔ∏è Passport Progress
        </a>
        <a href="{{ url_for('checkins') }}"
           style="display: block; padding: 15px; background: #5eb8ff; color: white; text-align: center; font-weight: 600; border-radius: 8px; text-decoration: none; box-shadow: 0 2px 6px rgba(0,0,0,0.15);">
           üìç Event Check-ins
        </a>
        <a href="{{ url_for('prizes') }}"
           style="display: block; padding: 15px; background: #2ecc71; color: white; text-align: center; font-weight: 600; border-radius: 8px; text-decoration: none; box-shadow: 0 2px 6px rgba(0,0,0,0.15);">
           üéÅ Recently Claimed Prizes
        </a>
    </div>

    <!-- Manage Account -->
    <div style="margin-top: 30px; padding: 15px; border: 1px solid #ccc; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
        <h3 style="margin-top: 0; text-align: center;">‚öôÔ∏è Manage My Account</h3>

        <div class="accordion">
            <!-- Change PIN -->
            <button type="button" class="accordion-toggle">üîë Change PIN</button>
            <div class="accordion-content">
                <form action="{{ url_for('change_pin') }}" method="post" style="margin-top: 10px;">
                    <input type="password" name="old_pin" placeholder="Old PIN" required style="width: 100%; margin: 5px 0;">
                    <input type="text" name="memorable" placeholder="Memorable Password" required style="width: 100%; margin: 5px 0;">
                    <div style="display: flex; align-items: center; margin: 5px 0;">
                        <input type="password" name="new_pin" id="new_pin" pattern="\d{4}" maxlength="4" placeholder="New 4-digit PIN" required style="flex: 1;">
                        <button type="button" onclick="togglePin()" style="margin-left: 5px; padding: 6px 10px; font-size: 0.8em;">Show</button>
                    </div>
                    <button type="submit" style="margin-top: 10px; width: 100%;">Update PIN</button>
                </form>
            </div>

            <!-- Change Memorable -->
            <button type="button" class="accordion-toggle">üìù Change Memorable Password</button>
            <div class="accordion-content">
                <form action="{{ url_for('change_memorable') }}" method="post" style="margin-top: 10px;">
                    <input type="text" name="old_memorable" placeholder="Old Memorable" required style="width: 100%; margin: 5px 0;">
                    <input type="text" name="new_memorable" placeholder="New Memorable" required style="width: 100%; margin: 5px 0;">
                    <button type="submit" style="margin-top: 10px; width: 100%;">Update Memorable</button>
                </form>
            </div>

            <!-- Security -->
            <button type="button" class="accordion-toggle">üîí Security</button>
            <div class="accordion-content">
                <form action="{{ url_for('logout_everywhere') }}" method="post">
                    <button type="submit" style="width: 100%;">Log Out Everywhere</button>
                </form>
            </div>

            <!-- Delete Account -->
            <button type="button" class="accordion-toggle">üóëÔ∏è Delete Account</button>
            <div class="accordion-content">
                <p style="font-size: 0.9em; color: #b00;">
                    ‚ö†Ô∏è This will permanently delete your account, including:
                    Passport stamps, RDAB profile, and prize history.
                    <strong>This cannot be undone.</strong>
                </p>
                <form action="{{ url_for('delete_account') }}" method="post">
                    <input type="text" name="confirm_name" placeholder="Type your trainer name to confirm" required style="width: 100%; margin: 5px 0;">
                    <button type="submit" style="margin-top: 10px; width: 100%; background: #e74c3c; color: white;">Delete My Account</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Accordion + Show/Hide script -->
<script>
    document.querySelectorAll(".accordion-toggle").forEach(btn => {
        btn.addEventListener("click", () => {
            btn.classList.toggle("active");
            const content = btn.nextElementSibling;
            if (content.style.maxHeight) {
                content.style.maxHeight = null;
            } else {
                content.style.maxHeight = content.scrollHeight + "px";
            }
        });
    });

    function togglePin() {
        const input = document.getElementById("new_pin");
        const btn = event.target;
        if (input.type === "password") {
            input.type = "text";
            btn.textContent = "Hide";
        } else {
            input.type = "password";
            btn.textContent = "Show";
        }
    }
</script>

<style>
    .accordion button.accordion-toggle {
        width: 100%;
        text-align: left;
        padding: 10px;
        background: #f0f0f0;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        margin-top: 8px;
    }
    .accordion button.accordion-toggle.active {
        background: #ddd;
    }
    .accordion .accordion-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        padding: 0 5px;
    }
    .accordion .accordion-content form input,
    .accordion .accordion-content form button {
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 6px;
    }
</style>

{% endblock %}