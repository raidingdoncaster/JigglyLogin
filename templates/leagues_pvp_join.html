{% extends "base.html" %}

{% block page_settings %}
  {% set container_class = 'is-cozy' %}
{% endblock %}

{% block content %}

<div class="pvp-join-header">
  <a href="{{ url_for('leagues', pvp_id=tournament.id) }}" class="back-link">‚Üê Back to Leagues</a>
  <h1>Join {{ tournament.name }}</h1>
  <p>This tournament takes place alongside an in-person meetup. Please only register if you can attend.</p>
</div>

<section class="pvp-join-card">
  <h2>Tournament Details</h2>
  <dl>
    <div>
      <dt>Status</dt>
      <dd>{{ tournament.status|replace('_', ' ')|title }}</dd>
    </div>
    {% if tournament.start_at %}
      <div>
        <dt>Start Time</dt>
        <dd>{{ tournament.start_at.strftime('%d %b %Y %H:%M') }} (UTC)</dd>
      </div>
    {% endif %}
    {% if tournament.location_text %}
      <div>
        <dt>Meetup</dt>
        <dd>{{ tournament.location_text }}</dd>
      </div>
    {% endif %}
    <div>
      <dt>Bracket</dt>
      <dd>{{ tournament.bracket_type|replace('_', ' ')|title }}</dd>
    </div>
  </dl>

  {% if rules %}
    <h3>Rules Highlight</h3>
    <ul>
      {% for rule in rules[:5] %}
        <li>
          {% if rule.title %}
            <strong>{{ rule.title }}:</strong>
          {% endif %}
          {{ rule.body or "" }}
        </li>
      {% endfor %}
    </ul>
  {% endif %}

  {% if prizes %}
    <h3>Prizes</h3>
    <ul>
      {% for prize in prizes %}
        <li><strong>Place {{ prize.placement }}:</strong> {{ prize.description }}</li>
      {% endfor %}
    </ul>
  {% elif tournament.prize_summary %}
    <p><strong>Prize:</strong> {{ tournament.prize_summary }}</p>
  {% endif %}
</section>

<form method="post" class="pvp-join-form">
  <div class="warning-box">
    <h3>Meetup Attendance Required</h3>
    <p>By joining this tournament you confirm that you will attend the meetup at the scheduled time and location.</p>
  </div>

  <label class="confirm-checkbox">
    <input type="checkbox" name="confirm_attendance" value="yes" required>
    I understand this tournament is tied to an in-person meetup and I will be there.
  </label>

  <div class="form-actions">
    <a class="btn-secondary" href="{{ url_for('leagues', pvp_id=tournament.id) }}">Cancel</a>
    <button type="submit" class="btn">Confirm Registration</button>
  </div>
</form>

<style>
.pvp-join-header {
  margin-bottom:18px;
}
.pvp-join-header h1 {
  margin:6px 0;
}
.pvp-join-card {
  background:#fff;
  border-radius:16px;
  padding:22px;
  box-shadow:0 12px 28px rgba(15,23,42,0.12);
  margin-bottom:20px;
}
.pvp-join-card dl {
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:14px;
  margin:0 0 16px;
}
.pvp-join-card dt {
  font-weight:600;
  color:#3a8dde;
}
.pvp-join-card dd {
  margin:4px 0 0;
  color:#1f2937;
}
.pvp-join-card ul {
  margin:12px 0 0;
  padding-left:18px;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.warning-box {
  background:#fef08a;
  border:1px solid #facc15;
  border-radius:12px;
  padding:16px;
  margin-bottom:16px;
}
.confirm-checkbox {
  display:flex;
  align-items:flex-start;
  gap:10px;
  font-weight:600;
  margin-bottom:18px;
}
.confirm-checkbox input {
  margin-top:4px;
}
.form-actions {
  display:flex;
  gap:12px;
}
.btn-secondary {
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:10px 16px;
  border-radius:12px;
  background:#e2e8f0;
  color:#1f2937;
  text-decoration:none;
  font-weight:600;
}
.btn {
  padding:10px 16px;
}
@media (max-width: 640px) {
  .pvp-join-card dl {
    grid-template-columns:repeat(1,minmax(0,1fr));
  }
  .form-actions {
    flex-direction:column;
    align-items:stretch;
  }
}
</style>

{% endblock %}
