{% extends "base.html" %}

{% block page_settings %}
  {% set container_class = 'is-wide' %}
{% endblock %}

{% block content %}

<div class="leagues-wrapper">

  <section class="leagues-section is-active" data-section="profile" id="leagues-tabpanel-profile" role="tabpanel" aria-labelledby="leagues-tab-profile" aria-hidden="false">
    <div class="league-profile-card" style="background-image: url('{{ url_for('static', filename='backgrounds/' ~ background) }}');">
      <div class="league-profile-overlay"></div>
      <div class="league-profile-body">
        <div class="league-profile-main">
          <img class="league-avatar" src="{{ url_for('static', filename='avatars/' ~ avatar) }}" alt="{{ trainer }} avatar">
          <div>
            <p class="league-kicker">Leagues Preview</p>
            <h1>{{ trainer }}'s League Profile</h1>
            <p class="league-subtitle">Your CDL scorecards, PvP standings, and limited-time event rewards will live here once the leagues rollout goes live.</p>
          </div>
        </div>
        <div class="league-profile-stats">
          <div class="league-stat">
            <span class="league-stat-label">Rank</span>
            <strong class="league-stat-value">{{ league_card.rank }}</strong>
          </div>
          <div class="league-stat">
            <span class="league-stat-label">CDL Points</span>
            <strong class="league-stat-value">{{ league_card.cdl_points }}</strong>
          </div>
          <div class="league-stat">
            <span class="league-stat-label">PvP Record</span>
            <strong class="league-stat-value">{{ league_card.pvp_record }}</strong>
          </div>
          <div class="league-stat">
            <span class="league-stat-label">Stamp Bonus</span>
            <strong class="league-stat-value">{{ league_card.stamp_bonus }}</strong>
          </div>
        </div>
        <button type="button" class="league-profile-expand" data-target="league-profile-expanded" aria-expanded="false" aria-controls="league-profile-expanded">
          Open Full Profile
        </button>
      </div>
    </div>

    <div class="league-profile-expanded" id="league-profile-expanded" aria-hidden="true" tabindex="-1">
      <div class="league-profile-expanded-card">
        <h3>Full League View</h3>
        <p>{{ league_card.season_highlight }}</p>
        <ul>
          {% for item in league_card.focus_items %}
            <li>{{ item }}</li>
          {% endfor %}
        </ul>
        <div class="league-profile-placeholder">
          Detailed stats, match history, and badge collections will appear here once the leagues modules are ready for launch.
        </div>
        <div class="roadmap-banner">
          <h3>What Happens Next?</h3>
          <div class="roadmap-steps">
            <div>
              <h4>Phase 1 - Data</h4>
              <p>Import CDL spreadsheets, sync Supabase tables, and generate your first scorecard previews.</p>
            </div>
            <div>
              <h4>Phase 2 - Live Ops</h4>
              <p>Enable meetup hosts to open or pause leagues mid-event with instant leaderboard refreshes.</p>
            </div>
            <div>
              <h4>Phase 3 - Automation</h4>
              <p>Automatically stamp passports from league placements and limited-time event milestones.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  {% for mode in league_modes %}
    {% if mode.key == "pvp" %}
      <section class="leagues-section" data-section="{{ mode.key }}" id="leagues-tabpanel-{{ mode.key }}" role="tabpanel" aria-labelledby="leagues-tab-{{ mode.key }}" aria-hidden="true" hidden>
        <div class="pvp-pane">
          {% if pvp_tournaments %}
            <div class="pvp-toolbar">
              <form method="get" action="{{ url_for('leagues') }}" class="pvp-toolbar__switcher">
                <input type="hidden" name="tab" value="pvp">
                <label for="pvp-selector" class="sr-only">Select tournament</label>
                <select id="pvp-selector" name="pvp_id" onchange="this.form.submit()">
                  {% for t in pvp_tournaments %}
                    <option value="{{ t.id }}" {% if t.id == pvp_selected_id %}selected{% endif %}>
                      {{ t.name }} • {{ t.status|replace('_', ' ')|title }}
                    </option>
                  {% endfor %}
                </select>
              </form>
            </div>
          {% endif %}

          {% set tournament = pvp_selected.tournament if pvp_selected else None %}

          {% if not tournament %}
            <div class="pvp-empty-state">
              <h3>No live tournaments right now</h3>
              <p>We’ll announce the next showdown here. Keep an eye out for new brackets and special formats soon.</p>
            </div>
          {% else %}
            <article class="pvp-hero">
              <div class="pvp-hero__gradient"></div>
              <div class="pvp-hero__content">
                <div class="pvp-hero__left">
                  <div class="pvp-hero__eyebrow">Featured Tournament</div>
                  <h3>{{ tournament.name }}</h3>
                  <div class="pvp-hero__tags">
                    <span class="pvp-chip pvp-chip--status">{{ tournament.status|replace('_', ' ')|title }}</span>
                    <span class="pvp-chip">{{ tournament.bracket_type|replace('_', ' ')|title }}</span>
                    {% if tournament.location_text %}
                      <span class="pvp-chip pvp-chip--ghost">{{ tournament.location_text }}</span>
                    {% endif %}
                  </div>
                  {% if tournament.description %}
                    <p class="pvp-hero__description">{{ tournament.description }}</p>
                  {% endif %}

                  <dl class="pvp-hero__facts">
                    {% if tournament.start_at %}
                      <div>
                        <dt>Kick-off</dt>
                        <dd>{{ tournament.start_at.strftime('%d %b %Y %H:%M') }} UTC</dd>
                      </div>
                    {% endif %}
                    {% if tournament.registration_close_at %}
                      <div>
                        <dt>Registration closes</dt>
                        <dd>{{ tournament.registration_close_at.strftime('%d %b %Y %H:%M') }} UTC</dd>
                      </div>
                    {% endif %}
                    <div>
                      <dt>Registered trainers</dt>
                      <dd>{{ pvp_selected.registrations|length }}</dd>
                    </div>
                  </dl>
                </div>
                <div class="pvp-hero__right">
                  <div class="pvp-hero__cta">
                    {% if pvp_registration %}
                      <span class="pvp-chip pvp-chip--success">You’re on the roster</span>
                      <a class="btn btn-secondary" href="{{ url_for('leagues_pvp_team', tournament_id=tournament.id) }}">Edit Team</a>
                    {% elif tournament.status == "REGISTRATION" %}
                      <a class="btn btn-primary" href="{{ url_for('leagues_pvp_join', tournament_id=tournament.id) }}">Join Tournament</a>
                      <p class="pvp-hero__note">Spots are limited — secure your slot while registration is open.</p>
                    {% else %}
                      <span class="pvp-chip pvp-chip--ghost">Registration Closed</span>
                      <p class="pvp-hero__note">Check the roster and cheer for your favourites while matches play out.</p>
                    {% endif %}
                  </div>
                </div>
              </div>
            </article>

            <div class="pvp-info-grid">
              <section class="pvp-card">
                <header>
                  <h4>Rules & Format</h4>
                  <span class="pvp-card__tag">Meta briefing</span>
                </header>
                {% if pvp_selected.rules %}
                  <ul class="pvp-list">
                    {% for rule in pvp_selected.rules %}
                      <li>
                        {% if rule.title %}
                          <strong>{{ rule.title }}:</strong>
                        {% endif %}
                        {{ rule.body or "" }}
                      </li>
                    {% endfor %}
                  </ul>
                {% else %}
                  <p>Rules will appear here as soon as the strategic briefing is finalised.</p>
                {% endif %}
              </section>

              <section class="pvp-card">
                <header>
                  <h4>Rewards</h4>
                  <span class="pvp-card__tag pvp-card__tag--gold">What’s at stake</span>
                </header>
                {% if pvp_selected.prizes %}
                  <ol class="pvp-prize-list">
                    {% for prize in pvp_selected.prizes %}
                      <li>
                        <span class="placement">#{{ prize.placement }}</span>
                        <span class="prize-copy">{{ prize.description }}</span>
                      </li>
                    {% endfor %}
                  </ol>
                {% elif tournament.prize_summary %}
                  <p>{{ tournament.prize_summary }}</p>
                {% else %}
                  <p>The prize pool is still being assembled — expect merch, stamps, and bragging rights.</p>
                {% endif %}
              </section>
            </div>

            <div class="pvp-columns">
              <section class="pvp-card">
                <header>
                  <h4>Registered Trainers</h4>
                  <span class="pvp-card__tag">{{ pvp_selected.registrations|length }} on deck</span>
                </header>
                {% if pvp_selected.registrations %}
                  <ul class="pvp-roster">
                    {% for reg in pvp_selected.registrations %}
                      <li>
                        <div class="pvp-roster__identity">
                          <strong>{{ reg.notes or "Trainer" }}</strong>
                          {% if reg.status %}
                            <span class="badge badge--light">{{ reg.status|title }}</span>
                          {% endif %}
                        </div>
                        <div class="roster-actions">
                          {% if reg.teams %}
                            <span class="team-count">{{ reg.teams|length }} Pokémon locked</span>
                            <button type="button"
                                    class="btn-small view-team"
                                    data-trainer="{{ reg.notes or 'Trainer' }}"
                                    data-team="{{ reg.teams|tojson|e }}">
                              View Team
                            </button>
                          {% else %}
                            <span class="team-count is-empty">Team pending</span>
                          {% endif %}
                        </div>
                      </li>
                    {% endfor %}
                  </ul>
                {% else %}
                  <p class="pvp-empty-card">No trainers have registered yet. Claim the first slot!</p>
                {% endif %}
              </section>

              <section class="pvp-card">
                <header>
                  <h4>Bracket Pulse</h4>
                  <span class="pvp-card__tag">Round progression</span>
                </header>
                {% if pvp_selected.matches %}
                  <ul class="pvp-bracket">
                    {% for match in pvp_selected.matches %}
                      <li>
                        <span class="round-label">Round {{ match.round_no }}</span>
                        <span class="round-status">{{ match.status|replace('_', ' ')|title }}</span>
                      </li>
                    {% endfor %}
                  </ul>
                {% else %}
                  <p class="pvp-empty-card">The bracket unlocks once the admin signals the start.</p>
                {% endif %}
              </section>

              <section class="pvp-card">
                <header>
                  <h4>Leaderboard</h4>
                  <span class="pvp-card__tag">Live standings</span>
                </header>
                {% if pvp_selected.leaderboard %}
                  <ol class="pvp-leaderboard">
                    {% for row in pvp_selected.leaderboard %}
                      <li>
                        <span class="pvp-rank-icon">{{ row.rank or loop.index }}</span>
                        <div>
                          <strong>{{ row.registration_id[:8] }}</strong>
                          <p>{{ row.points or 0 }} pts · {{ row.wins or 0 }}W / {{ row.losses or 0 }}L{% if row.draws %} / {{ row.draws }}D{% endif %}</p>
                        </div>
                      </li>
                    {% endfor %}
                  </ol>
                {% else %}
                  <p class="pvp-empty-card">Leaderboard standings appear once matches are reported.</p>
                {% endif %}
              </section>
            </div>
          {% endif %}

          <div class="pvp-bottom-grid">
            <section class="pvp-card pvp-card--archive">
              <header>
                <h4>Previous Tournaments</h4>
                <span class="pvp-card__tag">Tap to view final standings</span>
              </header>
              {% if pvp_archive %}
                <ul class="pvp-archive">
                  {% for history in pvp_archive %}
                    <li>
                      <div class="pvp-archive__info">
                        <strong>{{ history.name }}</strong>
                        <div class="archive-meta">
                          <span>{{ history.bracket_type|replace('_', ' ')|title }}</span>
                          {% if history.start_at %}
                            <span aria-hidden="true">•</span>
                            <span>{{ history.start_at.strftime('%d %b %Y') }}</span>
                          {% endif %}
                        </div>
                      </div>
                      <div class="pvp-archive__actions">
                        <span class="archive-status">{{ history.status|replace('_', ' ')|title }}</span>
                        <button
                          type="button"
                          class="archive-view"
                          data-archive-id="{{ history.id }}"
                          data-archive-name="{{ history.name }}"
                        >
                          View Rankings
                        </button>
                      </div>
                    </li>
                  {% endfor %}
                </ul>
              {% else %}
                <p class="archive-empty">We’ll showcase completed leagues here once the first brackets wrap up.</p>
              {% endif %}
            </section>
          </div>
        </div>
      </section>
    {% else %}
      <section class="leagues-section" data-section="{{ mode.key }}" id="leagues-tabpanel-{{ mode.key }}" role="tabpanel" aria-labelledby="leagues-tab-{{ mode.key }}" aria-hidden="true" hidden>
        <div class="mode-panel">
          {% if mode.key == "cdl" %}
            <div class="mode-card mode-card--wide">
              <h3>Coming Soon</h3>
              <p>CDL leagues are coming soon.</p>
            </div>
          {% elif mode.key == "limited" %}
            <div class="mode-card mode-card--wide">
              <h3>Coming Soon</h3>
              <p>Limited-time events are coming soon.</p>
            </div>
          {% endif %}
        </div>
      </section>
    {% endif %}
  {% endfor %}

</div>

<div class="team-modal" id="team-modal" hidden aria-hidden="true">
  <div class="team-modal-backdrop"></div>
  <div class="team-modal-dialog" role="dialog" aria-modal="true" aria-labelledby="team-modal-title">
    <header class="team-modal-header">
      <h2 id="team-modal-title">Trainer Team</h2>
      <button type="button" class="team-modal-close" aria-label="Close team view">✕</button>
    </header>
    <p class="team-modal-subtitle"></p>
    <div class="team-modal-body">
      <ol class="team-modal-list"></ol>
    </div>
  </div>
</div>

<div class="team-modal archive-modal" id="archive-modal" hidden aria-hidden="true">
  <div class="team-modal-backdrop"></div>
  <div class="team-modal-dialog" role="dialog" aria-modal="true" aria-labelledby="archive-modal-title">
    <header class="team-modal-header">
      <h2 id="archive-modal-title">Tournament Standings</h2>
      <button type="button" class="archive-modal-close" aria-label="Close standings">✕</button>
    </header>
    <p class="archive-modal-subtitle"></p>
    <div class="archive-modal-body">
      <ol class="archive-modal-list"></ol>
    </div>
  </div>
</div>

<div class="leagues-footer-nav-rail">
  <nav class="leagues-footer-nav" role="tablist" aria-label="Leagues navigation">
    <button type="button" class="nav-button is-active" data-section-target="profile" id="leagues-tab-profile" role="tab" aria-controls="leagues-tabpanel-profile" aria-selected="true" tabindex="0">
      Leagues Profile
    </button>
    <button type="button" class="nav-button" data-section-target="cdl" id="leagues-tab-cdl" role="tab" aria-controls="leagues-tabpanel-cdl" aria-selected="false" tabindex="-1">
      CDL
    </button>
    <button type="button" class="nav-button" data-section-target="pvp" id="leagues-tab-pvp" role="tab" aria-controls="leagues-tabpanel-pvp" aria-selected="false" tabindex="-1">
      PvP
    </button>
    <button type="button" class="nav-button" data-section-target="limited" id="leagues-tab-limited" role="tab" aria-controls="leagues-tabpanel-limited" aria-selected="false" tabindex="-1">
      Limited Time
    </button>
  </nav>
</div>

<script>
(function () {
  const navButtons = document.querySelectorAll(".leagues-footer-nav button");
  const sections = document.querySelectorAll(".leagues-section");
  const expandButton = document.querySelector(".league-profile-expand");
  const expandedPanel = document.getElementById("league-profile-expanded");

  const showSection = (target) => {
    sections.forEach((section) => {
      const isMatch = section.dataset.section === target;
      section.classList.toggle("is-active", isMatch);
      section.setAttribute("aria-hidden", String(!isMatch));
      if (isMatch) {
        section.removeAttribute("hidden");
      } else {
        section.setAttribute("hidden", "hidden");
      }
    });
    navButtons.forEach((button) => {
      const isMatch = button.dataset.sectionTarget === target;
      button.classList.toggle("is-active", isMatch);
      button.setAttribute("aria-selected", String(isMatch));
      button.setAttribute("tabindex", isMatch ? "0" : "-1");
    });
    if (target !== "profile" && expandedPanel && expandButton) {
      expandedPanel.classList.remove("is-open");
      expandedPanel.setAttribute("aria-hidden", "true");
      expandButton.setAttribute("aria-expanded", "false");
      expandButton.textContent = "Open Full Profile";
    }
  };

  navButtons.forEach((button) => {
    button.addEventListener("click", () => {
      showSection(button.dataset.sectionTarget);
      if (button.dataset.sectionTarget === "profile") {
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
    });
  });

  if (expandButton && expandedPanel) {
    expandButton.addEventListener("click", () => {
      const isOpen = expandedPanel.classList.toggle("is-open");
      expandedPanel.setAttribute("aria-hidden", String(!isOpen));
      expandButton.setAttribute("aria-expanded", String(isOpen));
      expandButton.textContent = isOpen ? "Close Full Profile" : "Open Full Profile";
    });
  }

  const modal = document.getElementById("team-modal");
  const modalList = modal?.querySelector(".team-modal-list");
  const modalSubtitle = modal?.querySelector(".team-modal-subtitle");
  const closeModal = () => {
    if (!modal) return;
    modal.setAttribute("hidden", "hidden");
    modal.setAttribute("aria-hidden", "true");
    modal.classList.remove("is-open");
  };
  modal?.querySelector(".team-modal-close")?.addEventListener("click", closeModal);
  modal?.querySelector(".team-modal-backdrop")?.addEventListener("click", closeModal);

  document.addEventListener("keydown", (evt) => {
    if (evt.key === "Escape" && modal?.classList.contains("is-open")) {
      closeModal();
    }
  });

  document.querySelectorAll(".view-team").forEach((button) => {
    button.addEventListener("click", () => {
      if (!modal || !modalList || !modalSubtitle) return;
      const trainer = button.getAttribute("data-trainer") || "Trainer";
      const rawTeam = button.getAttribute("data-team") || "[]";
      let team = [];
      try {
        team = JSON.parse(rawTeam);
      } catch (err) {
        console.error("Failed to parse team payload", err);
      }

      modalSubtitle.textContent = `${trainer}'s lineup`;
      modalList.innerHTML = "";
      if (!team || !team.length) {
        modalList.innerHTML = "<li>No team submitted yet.</li>";
      } else {
        team.forEach((slot, index) => {
          const item = document.createElement("li");
          const name = slot.species_name || "Mystery Pokémon";
          const form = slot.species_form ? ` (${slot.species_form})` : "";
          const notes = slot.moves?.notes || "";
          item.innerHTML = `<span class="team-slot-number">${index + 1}.</span>
            <div class="team-slot-content">
              <strong>${name}${form}</strong>
              ${notes ? `<p>${notes}</p>` : "" }
            </div>`;
          modalList.appendChild(item);
        });
      }

      modal.removeAttribute("hidden");
      modal.setAttribute("aria-hidden", "false");
      modal.classList.add("is-open");
    });
  });

  const archiveModal = document.getElementById("archive-modal");
  const archiveList = archiveModal?.querySelector(".archive-modal-list");
  const archiveSubtitle = archiveModal?.querySelector(".archive-modal-subtitle");
  const archiveTitle = document.getElementById("archive-modal-title");

  const closeArchiveModal = () => {
    if (!archiveModal) return;
    archiveModal.setAttribute("hidden", "hidden");
    archiveModal.setAttribute("aria-hidden", "true");
    archiveModal.classList.remove("is-open");
  };

  const renderArchiveStandings = (rows) => {
    if (!archiveList) {
      return;
    }
    archiveList.innerHTML = "";
    if (!rows || !rows.length) {
      const empty = document.createElement("li");
      empty.className = "archive-modal-placeholder";
      empty.textContent = "No standings posted for this tournament yet.";
      archiveList.appendChild(empty);
      return;
    }

    rows.forEach((row, index) => {
      const li = document.createElement("li");

      const rank = document.createElement("span");
      rank.className = "archive-rank";
      const rankValue = row.rank ?? index + 1;
      rank.textContent = typeof rankValue === "number" ? String(rankValue) : (rankValue || `${index + 1}`);

      const body = document.createElement("div");
      body.className = "archive-entry";

      const trainer = document.createElement("strong");
      const trainerName = row.trainer || `Registration ${index + 1}`;
      trainer.textContent = trainerName;

      const facts = document.createElement("p");
      const wins = row.wins ?? 0;
      const losses = row.losses ?? 0;
      const draws = row.draws ?? 0;
      const points = row.points ?? 0;
      const wlParts = [`${wins}W`, `${losses}L`];
      if (draws) {
        wlParts.push(`${draws}D`);
      }
      facts.textContent = `${points} pts • ${wlParts.join(" / ")}`;

      body.appendChild(trainer);
      body.appendChild(facts);

      li.appendChild(rank);
      li.appendChild(body);
      archiveList.appendChild(li);
    });
  };

  const showArchiveModal = () => {
    if (!archiveModal) {
      return;
    }
    archiveModal.removeAttribute("hidden");
    archiveModal.setAttribute("aria-hidden", "false");
    archiveModal.classList.add("is-open");
  };

  archiveModal?.querySelector(".archive-modal-close")?.addEventListener("click", closeArchiveModal);
  archiveModal?.querySelector(".team-modal-backdrop")?.addEventListener("click", closeArchiveModal);

  document.addEventListener("keydown", (evt) => {
    if (evt.key === "Escape" && archiveModal?.classList.contains("is-open")) {
      closeArchiveModal();
    }
  });

  document.querySelectorAll(".archive-view").forEach((button) => {
    button.addEventListener("click", async () => {
      if (!archiveModal || !archiveList || !archiveSubtitle) return;
      const tournamentId = button.getAttribute("data-archive-id");
      if (!tournamentId) return;

      const fetchUrl = `/leagues/pvp/${encodeURIComponent(tournamentId)}/archive`;
      if (archiveTitle) {
        archiveTitle.textContent = button.getAttribute("data-archive-name") || "Tournament Standings";
      }
      archiveSubtitle.textContent = "Loading standings…";
      archiveList.innerHTML = "";
      const loading = document.createElement("li");
      loading.className = "archive-modal-placeholder";
      loading.textContent = "Loading standings…";
      archiveList.appendChild(loading);

      showArchiveModal();

      try {
        const response = await fetch(fetchUrl, { headers: { Accept: "application/json" } });
        if (!response.ok) {
          throw new Error(`Failed to load standings (${response.status})`);
        }
        const payload = await response.json();
        const tournament = payload?.tournament || {};
        if (archiveTitle && tournament.name) {
          archiveTitle.textContent = tournament.name;
        }
        const metaBits = [];
        if (tournament.bracket_type) {
          metaBits.push(tournament.bracket_type.replace(/_/g, " "));
        }
        if (tournament.status) {
          metaBits.push(tournament.status.replace(/_/g, " "));
        }
        const eventDate = tournament.conclude_at || tournament.start_at;
        if (eventDate) {
          const parsed = new Date(eventDate);
          if (!Number.isNaN(parsed.valueOf())) {
            metaBits.push(parsed.toLocaleDateString(undefined, { day: "2-digit", month: "short", year: "numeric" }));
          }
        }
        archiveSubtitle.textContent = metaBits.join(" • ");
        renderArchiveStandings(Array.isArray(payload?.leaderboard) ? payload.leaderboard : []);
      } catch (err) {
        console.error(err);
        archiveSubtitle.textContent = "";
        if (archiveList) {
          archiveList.innerHTML = "";
          const errorItem = document.createElement("li");
          errorItem.className = "archive-modal-placeholder";
          errorItem.textContent = "We couldn’t load the standings right now. Please try again later.";
          archiveList.appendChild(errorItem);
        }
      }
    });
  });

  showSection("profile");
})();
</script>

<style>
.leagues-wrapper {
  display:flex;
  flex-direction:column;
  gap:18px;
  margin-bottom:72px;
}
.leagues-section {
  display:none;
}
.leagues-section.is-active {
  display:block;
}
.league-profile-card {
  position:relative;
  background-size:cover;
  background-position:center;
  border-radius:16px;
  overflow:hidden;
  color:#fff;
  box-shadow:0 14px 30px rgba(15,23,42,0.28);
}
.league-profile-overlay {
  position:absolute;
  inset:0;
  background:linear-gradient(135deg, rgba(9,14,35,0.78) 0%, rgba(9,14,35,0.35) 100%);
  pointer-events:none;
}
.league-profile-body {
  position:relative;
  z-index:1;
  padding:22px;
  display:flex;
  flex-direction:column;
  gap:18px;
}
.league-profile-main {
  display:flex;
  align-items:flex-start;
  gap:16px;
}
.league-avatar {
  width:72px;
  height:72px;
  border-radius:50%;
  border:3px solid rgba(255,255,255,0.85);
  box-shadow:0 6px 16px rgba(15,23,42,0.45);
  object-fit:cover;
}
.league-kicker {
  margin:0;
  text-transform:uppercase;
  letter-spacing:0.08em;
  font-size:0.75em;
  color:#60a5fa;
  font-weight:600;
}
.league-profile-body h1 {
  margin:4px 0 8px;
}
.league-subtitle {
  margin:0;
  max-width:520px;
  color:rgba(255,255,255,0.88);
}
.league-profile-stats {
  display:grid;
  grid-template-columns:repeat(4,minmax(0,1fr));
  gap:16px;
}
.league-stat {
  background:rgba(15,23,42,0.55);
  border-radius:14px;
  padding:14px;
  display:flex;
  flex-direction:column;
  gap:4px;
  box-shadow:0 8px 20px rgba(15,23,42,0.25);
}
.league-stat-label {
  font-size:0.78em;
  letter-spacing:0.05em;
  text-transform:uppercase;
  color:rgba(255,255,255,0.7);
}
.league-stat-value {
  font-size:1.05em;
  font-weight:700;
}
.league-profile-expand {
  align-self:flex-start;
  padding:10px 18px;
  border-radius:999px;
  border:none;
  background:#fde68a;
  color:#1f2937;
  font-weight:600;
  cursor:pointer;
  transition:transform 0.15s ease, box-shadow 0.15s ease;
  box-shadow:0 10px 20px rgba(252,211,77,0.35);
}
.league-profile-expand:hover {
  transform:translateY(-1px);
  box-shadow:0 12px 24px rgba(252,211,77,0.45);
}
.league-profile-expanded {
  display:none;
  margin-top:16px;
  max-height:360px;
  overflow-y:auto;
}
.league-profile-expanded.is-open {
  display:block;
}
.league-profile-expanded-card {
  background:#fff;
  border-radius:16px;
  padding:22px;
  box-shadow:0 12px 28px rgba(15,23,42,0.12);
  color:#1f2937;
}
.league-profile-expanded-card h3 {
  margin-top:0;
}
.league-profile-expanded-card ul {
  margin:12px 0 16px;
  padding-left:18px;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.league-profile-placeholder {
  border:1px dashed #cbd5f5;
  border-radius:12px;
  padding:16px;
  background:#f8fafc;
  color:#475569;
  font-size:0.95em;
  margin-bottom:18px;
}
.mode-panel {
  background:#fff;
  border-radius:16px;
  padding:22px;
  box-shadow:0 12px 28px rgba(15,23,42,0.12);
}
.mode-header h2 {
  margin:0 0 6px;
}
.mode-grid {
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:16px;
  margin-top:18px;
}
.mode-card {
  background:#f8fafc;
  border-radius:14px;
  padding:18px;
  box-shadow:inset 0 0 0 1px rgba(148,163,184,0.25);
}
.mode-card h3 {
  margin-top:0;
}
.mode-card ul {
  margin:12px 0 0;
  padding-left:18px;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.mode-card--wide {
  margin-top:18px;
}
.pvp-pane {
  display:flex;
  flex-direction:column;
  gap:18px;
}
.pvp-toolbar {
  display:flex;
  justify-content:space-between;
  gap:16px;
  align-items:flex-end;
}
.pvp-toolbar__meta h2 {
  margin:0 0 6px;
}
.pvp-toolbar__meta p {
  margin:0;
  color:#475569;
}
.pvp-toolbar__switcher select {
  padding:10px 14px;
  border-radius:12px;
  border:1px solid #cbd5f5;
  font-weight:600;
  background:#fff;
  box-shadow:0 6px 16px rgba(15,23,42,0.08);
}
.pvp-hero {
  position:relative;
  overflow:hidden;
  border-radius:20px;
  color:#fff;
}
.pvp-hero__gradient {
  position:absolute;
  inset:0;
  background:linear-gradient(135deg,#1e3a8a,#6366f1 55%,#22d3ee);
  opacity:0.95;
}
.pvp-hero__content {
  position:relative;
  z-index:1;
  display:flex;
  justify-content:space-between;
  gap:24px;
  padding:28px;
}
.pvp-hero__left {
  max-width:70%;
  display:flex;
  flex-direction:column;
  gap:14px;
}
.pvp-hero__eyebrow {
  text-transform:uppercase;
  font-size:0.75em;
  letter-spacing:0.08em;
  opacity:0.75;
}
.pvp-hero__tags {
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.pvp-chip {
  display:inline-flex;
  align-items:center;
  padding:6px 12px;
  border-radius:999px;
  background:rgba(255,255,255,0.2);
  font-weight:600;
  font-size:0.8em;
}
.pvp-chip--status {
  background:rgba(236,72,153,0.25);
}
.pvp-chip--ghost {
  background:rgba(15,23,42,0.22);
}
.pvp-chip--success {
  background:rgba(34,197,94,0.3);
}
.pvp-hero__description {
  margin:0;
  font-size:1em;
  line-height:1.5;
  color:rgba(255,255,255,0.92);
}
.pvp-hero__facts {
  display:flex;
  gap:24px;
  flex-wrap:wrap;
  margin:0;
}
.pvp-hero__facts div {
  display:flex;
  flex-direction:column;
  gap:2px;
}
.pvp-hero__facts dt {
  font-size:0.75em;
  letter-spacing:0.08em;
  text-transform:uppercase;
  opacity:0.75;
}
.pvp-hero__facts dd {
  margin:0;
  font-weight:600;
}
.pvp-hero__right {
  display:flex;
  flex-direction:column;
  gap:12px;
  align-items:flex-end;
  min-width:200px;
}
.pvp-hero__cta {
  display:flex;
  flex-direction:column;
  gap:10px;
  align-items:flex-end;
}
.pvp-hero__note {
  margin:0;
  font-size:0.85em;
  color:rgba(255,255,255,0.75);
  text-align:right;
}
.btn-primary,
.btn-secondary {
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:10px 18px;
  border-radius:12px;
  font-weight:600;
  text-decoration:none;
}
.btn-primary {
  background:#facc15;
  color:#0f172a;
  box-shadow:0 12px 24px rgba(250,204,21,0.35);
}
.btn-secondary {
  background:#1f2937;
  color:#fff;
  box-shadow:0 10px 20px rgba(15,23,42,0.3);
}
.pvp-info-grid {
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:16px;
}
.pvp-card {
  background:#fff;
  border-radius:18px;
  padding:20px;
  box-shadow:0 12px 28px rgba(15,23,42,0.12);
  display:flex;
  flex-direction:column;
  gap:12px;
}
.pvp-card--archive {
  background:linear-gradient(135deg,rgba(59,130,246,0.08),rgba(14,165,233,0.1));
  box-shadow:0 16px 32px rgba(14,116,181,0.2);
}
.pvp-card header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
}
.pvp-card__tag {
  font-size:0.75em;
  text-transform:uppercase;
  letter-spacing:0.08em;
  background:#e0e7ff;
  color:#312e81;
  padding:4px 10px;
  border-radius:999px;
  font-weight:600;
}
.pvp-card__tag--gold {
  background:#fef3c7;
  color:#b45309;
}
.pvp-list,
.pvp-prize-list {
  margin:0;
  padding-left:18px;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.pvp-prize-list {
  list-style:none;
  padding:0;
}
.pvp-prize-list li {
  display:flex;
  gap:12px;
  align-items:center;
}
.pvp-prize-list .placement {
  width:32px;
  height:32px;
  border-radius:12px;
  background:#1d4ed8;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
}
.pvp-prize-list .prize-copy {
  font-weight:600;
  color:#1f2937;
}
.pvp-archive__info {
  display:flex;
  flex-direction:column;
  gap:6px;
}
.pvp-archive__info strong {
  font-size:1em;
  color:#0f172a;
}
.pvp-archive__actions {
  display:flex;
  flex-direction:column;
  align-items:flex-end;
  gap:6px;
}
.archive-view {
  padding:8px 12px;
  border-radius:10px;
  border:none;
  background:#1d4ed8;
  color:#fff;
  font-size:0.85em;
  font-weight:600;
  cursor:pointer;
  box-shadow:0 8px 16px rgba(29,78,216,0.25);
}
.archive-view:hover {
  background:#2563eb;
}
.archive-empty {
  margin:0;
  padding:22px;
  border-radius:14px;
  background:#eef2ff;
  color:#1d4ed8;
  font-weight:600;
  text-align:center;
}
.pvp-columns {
  display:grid;
  grid-template-columns:repeat(3,minmax(0,1fr));
  gap:16px;
}
.pvp-roster {
  list-style:none;
  padding:0;
  margin:0;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.pvp-roster li {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 12px;
  border-radius:12px;
  background:#f8fafc;
  box-shadow:inset 0 0 0 1px rgba(148,163,184,0.20);
}
.pvp-roster__identity {
  display:flex;
  flex-direction:column;
  gap:4px;
}
.roster-actions {
  display:flex;
  align-items:center;
  gap:10px;
}
.team-count {
  font-size:0.8em;
  color:#3a8dde;
  font-weight:600;
}
.team-count.is-empty {
  color:#94a3b8;
}
.btn-small {
  padding:6px 10px;
  border-radius:10px;
  border:none;
  background:#3a8dde;
  color:#fff;
  font-size:0.8em;
  cursor:pointer;
}
.badge {
  display:inline-flex;
  align-items:center;
  padding:6px 10px;
  border-radius:999px;
  background:#e2e8f0;
  color:#1f2937;
  font-size:0.75em;
  font-weight:600;
}
.badge--success {
  background:#22c55e;
  color:#fff;
}
.badge--light {
  background:#cbd5f5;
  color:#1f2937;
}
.pvp-bracket,
.pvp-leaderboard,
.pvp-archive {
  list-style:none;
  padding:0;
  margin:0;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.pvp-bracket li,
.pvp-leaderboard li,
.pvp-archive li {
  background:#f8fafc;
  border-radius:12px;
  padding:12px;
  box-shadow:inset 0 0 0 1px rgba(148,163,184,0.16);
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
}
.round-label {
  font-weight:700;
  color:#1d4ed8;
}
.round-status {
  font-size:0.85em;
  color:#475569;
}
.pvp-leaderboard li div p {
  margin:2px 0 0;
  font-size:0.8em;
  color:#64748b;
}
.pvp-rank-icon {
  width:36px;
  height:36px;
  border-radius:12px;
  background:#1e3a8a;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
}
.pvp-archive li {
  align-items:center;
  flex-direction:row;
  gap:16px;
}
.archive-meta {
  font-size:0.85em;
  color:#475569;
  display:flex;
  align-items:center;
  gap:6px;
}
.archive-status {
  font-size:0.75em;
  color:#2563eb;
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:0.05em;
}
.pvp-empty-card {
  margin:0;
  color:#64748b;
  font-style:italic;
}
.pvp-bottom-grid {
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:16px;
}
.pvp-card--gradient {
  background:linear-gradient(135deg,#f472b6,#7c3aed);
  color:#fff;
  box-shadow:0 16px 32px rgba(124,58,237,0.35);
}
.pvp-card--gradient ul li {
  color:rgba(255,255,255,0.92);
}
.pvp-empty-state {
  background:#0f172a;
  color:#fff;
  border-radius:18px;
  padding:28px;
  text-align:center;
  box-shadow:0 18px 34px rgba(15,23,42,0.4);
}
.pvp-empty-state h3 {
  margin:0 0 8px;
}
.pvp-empty-state p {
  margin:0;
  color:rgba(255,255,255,0.84);
}
.sr-only {
  position:absolute;
  width:1px;
  height:1px;
  padding:0;
  margin:-1px;
  overflow:hidden;
  clip:rect(0,0,0,0);
  border:0;
}
.placeholder-scorecard {
  margin-top:14px;
  display:grid;
  grid-template-columns:repeat(3,minmax(0,1fr));
  gap:12px;
}
.placeholder-scorecard div {
  background:#fff;
  border-radius:12px;
  padding:12px;
  box-shadow:0 8px 16px rgba(15,23,42,0.1);
  text-align:center;
}
.placeholder-scorecard .label {
  display:block;
  font-size:0.8em;
  color:#64748b;
}
.placeholder-scorecard .value {
  display:block;
  margin-top:4px;
  font-weight:700;
  font-size:1em;
  color:#1f2937;
}
.playbook-highlights {
  margin-top:12px;
  padding-left:18px;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.activity-grid {
  margin-top:14px;
  display:grid;
  grid-template-columns:repeat(3,minmax(0,1fr));
  gap:16px;
}
.activity-card {
  background:#fff;
  border-radius:12px;
  padding:16px;
  box-shadow:0 10px 18px rgba(15,23,42,0.08);
}
.activity-card h4 {
  margin:0 0 8px;
}
.activity-card ul {
  margin:0;
  padding-left:16px;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.roadmap-banner {
  background:#f8fafc;
  border-radius:14px;
  padding:18px;
  box-shadow:inset 0 0 0 1px rgba(148,163,184,0.25);
}
.roadmap-banner h3 {
  margin:0 0 10px;
  color:#3a8dde;
}
.roadmap-steps {
  display:grid;
  grid-template-columns:repeat(3,minmax(0,1fr));
  gap:16px;
}
.roadmap-steps div {
  background:#fff;
  border-radius:12px;
  padding:16px;
  box-shadow:0 8px 16px rgba(15,23,42,0.08);
}
.roadmap-steps h4 {
  margin:0 0 6px;
  color:#3a8dde;
}
.leagues-footer-nav-rail {
  position:sticky;
  bottom:0;
  margin-top:32px;
  padding:16px 0 calc(env(safe-area-inset-bottom, 0) + 12px);
  display:flex;
  justify-content:center;
  background:linear-gradient(180deg, rgba(244,247,250,0), rgba(244,247,250,0.9) 60%, rgba(244,247,250,1));
  z-index:19;
}
.leagues-footer-nav {
  position:relative;
  display:flex;
  gap:10px;
  background:rgba(255,255,255,0.95);
  padding:12px 16px;
  border-radius:16px 16px 0 0;
  border:1px solid #dbe0ea;
  box-shadow:0 -8px 20px rgba(15,23,42,0.12);
  backdrop-filter:blur(12px);
  width:min(100%,720px);
  margin:0 auto;
  z-index:20;
}
.nav-button {
  flex:1;
  padding:10px 12px;
  border-radius:12px;
  border:none;
  background:#e2e8f0;
  color:#1f2937;
  font-weight:600;
  cursor:pointer;
  transition:all 0.18s ease;
}
.nav-button.is-active {
  background:#3a8dde;
  color:#fff;
  box-shadow:0 10px 20px rgba(58,141,222,0.28);
}
.nav-button:focus-visible {
  outline:3px solid #93c5fd;
  outline-offset:2px;
}
.team-modal {
  position:fixed;
  inset:0;
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:2000;
}
.team-modal[hidden] {
  display:none;
}
.team-modal-backdrop {
  position:absolute;
  inset:0;
  background:rgba(15,23,42,0.6);
  backdrop-filter:blur(6px);
}
.team-modal-dialog {
  position:relative;
  background:#fff;
  border-radius:18px;
  padding:22px;
  width:min(520px, 92vw);
  max-height:80vh;
  overflow:auto;
  box-shadow:0 20px 40px rgba(15,23,42,0.2);
}
.team-modal-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}
.team-modal-close {
  border:none;
  background:transparent;
  font-size:1.2em;
  cursor:pointer;
  color:#64748b;
}
.team-modal-subtitle {
  margin:0 0 12px;
  color:#475569;
  font-weight:600;
}
.team-modal-list {
  list-style:none;
  padding:0;
  margin:0;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.team-modal-list li {
  display:flex;
  gap:12px;
  background:#f8fafc;
  border-radius:12px;
  padding:12px;
  box-shadow:inset 0 0 0 1px rgba(148,163,184,0.2);
}
.team-slot-number {
  font-weight:700;
  color:#3a8dde;
}
.team-slot-content p {
  margin:4px 0 0;
  color:#475569;
  font-size:0.9em;
}
.archive-modal .team-modal-dialog {
  width:min(420px, 92vw);
}
.archive-modal-subtitle {
  margin:0 0 16px;
  color:#475569;
  font-weight:600;
}
.archive-modal-body {
  max-height:60vh;
  overflow:auto;
}
.archive-modal-list {
  list-style:none;
  padding:0;
  margin:0;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.archive-modal-list li {
  display:flex;
  align-items:center;
  gap:12px;
  background:#f8fafc;
  border-radius:12px;
  padding:12px;
  box-shadow:inset 0 0 0 1px rgba(148,163,184,0.14);
}
.archive-modal-placeholder {
  justify-content:center;
  font-style:italic;
  color:#475569;
}
.archive-rank {
  width:32px;
  height:32px;
  border-radius:10px;
  background:#1d4ed8;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
}
.archive-entry {
  display:flex;
  flex-direction:column;
  gap:4px;
}
.archive-entry strong {
  color:#0f172a;
}
.archive-entry p {
  margin:0;
  font-size:0.85em;
  color:#475569;
}

@media (max-width: 960px) {
  .league-profile-stats {
    grid-template-columns:repeat(2,minmax(0,1fr));
  }
  .mode-grid,
  .placeholder-scorecard,
  .activity-grid,
  .roadmap-steps,
  .pvp-info-grid,
  .pvp-columns,
  .pvp-bottom-grid {
    grid-template-columns:repeat(1,minmax(0,1fr));
  }
}

@media (max-width: 640px) {
  .league-profile-body {
    padding:18px;
  }
  .league-profile-main {
    flex-direction:column;
    align-items:flex-start;
  }
  .league-profile-stats {
    grid-template-columns:repeat(1,minmax(0,1fr));
  }
  .pvp-toolbar {
    flex-direction:column;
    align-items:flex-start;
  }
  .pvp-toolbar__switcher select {
    width:100%;
  }
  .pvp-hero__content {
    flex-direction:column;
  }
  .pvp-hero__left {
    max-width:100%;
  }
  .pvp-hero__right {
    align-items:flex-start;
  }
  .pvp-card {
    padding:18px;
  }
  .pvp-bottom-grid {
    grid-template-columns:repeat(1,minmax(0,1fr));
  }
  .nav-button {
    font-size:0.85em;
  }
}
</style>

{% endblock %}
