{% extends "base.html" %}

{% block page_settings %}
  {% set container_class = 'is-wide' %}
{% endblock %}

{% block content %}
<div class="city-perks-header">
  <div>
    <h1>üèôÔ∏è City Perks</h1>
    <p>Manage the live offers that appear inside the trainer dashboard.</p>
  </div>
  <a class="btn-primary" href="{{ url_for('admin_city_perks.create_city_perk') }}">New City Perk</a>
</div>

<form class="city-perks-filters" method="get">
  <div class="filter-field">
    <label>Status</label>
    <select name="status">
      {% for key, label in status_choices %}
        <option value="{{ key }}" {% if status_filter == key %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="filter-field">
    <label>Area</label>
    <select name="area">
      <option value="">All areas</option>
      {% for area in areas %}
        <option value="{{ area }}" {% if area_filter == area %}selected{% endif %}>{{ area }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="filter-field">
    <label>Category</label>
    <select name="category">
      <option value="">All categories</option>
      {% for category in categories %}
        <option value="{{ category }}" {% if category_filter == category %}selected{% endif %}>{{ category }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="filter-field is-search">
    <label>Search</label>
    <input type="search" name="q" placeholder="Name or partner" value="{{ search_term }}">
  </div>
  <div class="filter-actions">
    <button type="submit">Apply</button>
    <a class="btn-reset" href="{{ url_for('admin_city_perks.list_city_perks') }}">Reset</a>
  </div>
</form>

{% if perks %}
  <div class="table-scroll">
    <table class="city-perks-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Mode</th>
          <th>Category</th>
          <th>Area</th>
          <th>Status</th>
          <th>Start ‚Üí End</th>
          <th>Flags</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for perk in perks %}
          <tr>
            <td>
              <div class="perk-name">{{ perk.name }}</div>
              <small>{{ perk.partner_name }}</small>
              {% if perk.short_tagline %}
                <p class="perk-tagline">{{ perk.short_tagline }}</p>
              {% endif %}
            </td>
            <td>
              <span class="mode-badge">
                {{ perk.perk_mode_icon }} {{ perk.perk_mode_label }}
              </span>
            </td>
            <td>{{ perk.category or "‚Äî" }}</td>
            <td>{{ perk.area or "‚Äî" }}</td>
            <td>
              {% set status_label = perk.status(now) %}
              <span class="status-pill status-{{ status_label|lower }}">
                {{ status_label }}
              </span>
            </td>
            <td class="dates-cell">
              <div>
                <strong>Start:</strong>
                {{ perk.start_date.strftime("%d %b %Y %H:%M") if perk.start_date else "‚Äî" }}
              </div>
              <div>
                <strong>End:</strong>
                {{ perk.end_date.strftime("%d %b %Y %H:%M") if perk.end_date else "‚Äî" }}
              </div>
            </td>
            <td>
              <div class="flag-pill {% if perk.show_on_map %}is-on{% endif %}">Map</div>
              <div class="flag-pill {% if perk.is_active %}is-on{% endif %}">Active</div>
            </td>
            <td>
              <a class="btn-secondary" href="{{ url_for('admin_city_perks.edit_city_perk', perk_id=perk.id) }}">Edit</a>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="empty-state">
    <h3>No City Perks found</h3>
    <p>Adjust the filters or add a new perk to get started.</p>
  </div>
{% endif %}

<style>
.city-perks-header {
  display:flex;
  justify-content:space-between;
  gap:18px;
  align-items:center;
  flex-wrap:wrap;
}
.city-perks-header h1 { margin:0; }
.city-perks-header p { margin:4px 0 0; color:#5f6b7c; }
.btn-primary, .btn-secondary {
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:10px 18px;
  border-radius:12px;
  text-decoration:none;
  font-weight:600;
  border:0;
}
.btn-primary {
  background:var(--brand);
  color:#fff;
  box-shadow:0 10px 20px rgba(58,141,222,0.35);
}
.btn-secondary {
  background:#eef2ff;
  color:#243073;
}
.city-perks-filters {
  margin:24px 0;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:16px;
  background:#f8fafc;
  border-radius:16px;
  padding:16px;
}
.city-perks-filters label {
  display:block;
  font-weight:600;
  font-size:0.85rem;
  margin-bottom:6px;
  color:#475467;
}
.city-perks-filters select,
.city-perks-filters input[type="search"] {
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid #d0d5dd;
  font-size:0.95rem;
}
.filter-field.is-search {
  grid-column:span 2;
}
.filter-actions {
  display:flex;
  gap:8px;
  align-items:flex-end;
}
.filter-actions button,
.filter-actions .btn-reset {
  padding:10px 16px;
  border-radius:10px;
  border:0;
  font-weight:600;
}
.filter-actions button {
  background:#111827;
  color:#fff;
}
.filter-actions .btn-reset {
  background:#fff;
  color:#1d4ed8;
  text-decoration:none;
  border:1px solid #d0d5dd;
}
.table-scroll {
  overflow:auto;
  border-radius:16px;
  border:1px solid #e4e7ec;
}
.city-perks-table {
  width:100%;
  border-collapse:collapse;
  min-width:960px;
  background:#fff;
}
.city-perks-table th,
.city-perks-table td {
  padding:14px 16px;
  text-align:left;
  border-bottom:1px solid #eff1f5;
  vertical-align:top;
  font-size:0.95rem;
}
.city-perks-table th {
  background:#f9fafb;
  font-size:0.85rem;
  letter-spacing:0.05em;
  text-transform:uppercase;
  color:#475467;
}
.perk-name { font-weight:600; }
.perk-tagline {
  margin:6px 0 0;
  font-size:0.85rem;
  color:#475467;
}
.mode-badge {
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 10px;
  border-radius:999px;
  background:#eef2ff;
  font-size:0.85rem;
  font-weight:600;
}
.status-pill {
  display:inline-flex;
  align-items:center;
  padding:6px 12px;
  border-radius:999px;
  font-weight:600;
  font-size:0.85rem;
  text-transform:uppercase;
}
.status-live { background:#dcfce7; color:#166534; }
.status-scheduled { background:#fef9c3; color:#854d0e; }
.status-expired { background:#fee2e2; color:#b91c1c; }
.status-inactive { background:#e4e7ec; color:#475467; }
.dates-cell div {
  font-size:0.85rem;
  margin-bottom:4px;
  color:#111827;
}
.flag-pill {
  display:inline-flex;
  padding:4px 10px;
  margin:2px;
  border-radius:999px;
  background:#eceef3;
  font-size:0.8rem;
  font-weight:600;
  color:#475467;
}
.flag-pill.is-on {
  background:#dbeafe;
  color:#1d4ed8;
}
.empty-state {
  padding:40px;
  text-align:center;
  border-radius:20px;
  background:#f8fafc;
}
.empty-state h3 { margin:0 0 6px; }
</style>
{% endblock %}
