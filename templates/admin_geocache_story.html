{% extends "base.html" %}

{% block page_settings %}
  {% set container_class = 'is-wide' %}
{% endblock %}

{% block content %}
  <div class="story-header">
    <h1>ðŸŒ¿ Geocache Quest Story</h1>
    <p>Scenes are now defined in <code>geocache/story.py</code>. Update that file to change the adventure.</p>
    <a class="button" href="{{ url_for('geocache.quest_shell') }}" target="_blank" rel="noopener">Open quest</a>
  </div>

  <section class="scene-list">
    {% for scene_id, scene in scene_items %}
      <article class="scene-card">
        <header>
          <h2>{{ scene.heading or scene_id }}</h2>
          <p class="scene-id"><strong>Scene ID:</strong> {{ scene_id }}</p>
          {% if scene.summary %}
            <p class="scene-summary">{{ scene.summary }}</p>
          {% endif %}
        </header>

        {% if scene.body %}
          <div class="scene-body">
            {% for paragraph in scene.body %}
              <p>{{ paragraph }}</p>
            {% endfor %}
          </div>
        {% endif %}

        {% if scene.options %}
          <div class="scene-options">
            <strong>Options</strong>
            <ul>
              {% for option in scene.options %}
                <li>
                  {{ option.label }}
                  {% if option.next %}
                    â†’ <code>{{ option.next }}</code>
                  {% elif option.action %}
                    â†’ <em>action:</em> <code>{{ option.action }}</code>
                  {% endif %}
                </li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}
      </article>
    {% endfor %}
  </section>

  <section class="raw-json">
    <details>
      <summary>View raw JSON</summary>
      <pre>{{ story | tojson(indent=2) }}</pre>
    </details>
  </section>

  <style>
    .story-header {
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:24px;
    }
    .story-header h1 { margin:0; }
    .story-header p { flex:1 1 320px; margin:0; color:#466; }
    .story-header .button {
      padding:10px 18px;
      border-radius:999px;
      text-decoration:none;
      color:#fff;
      background:linear-gradient(135deg,#3a8dde,#9c6bff);
      font-weight:600;
    }

    .scene-list {
      display:grid;
      gap:18px;
      grid-template-columns:repeat(auto-fill, minmax(260px,1fr));
    }
    .scene-card {
      border:1px solid rgba(15,23,42,0.08);
      border-radius:14px;
      padding:18px;
      background:#fff;
      box-shadow:0 16px 32px rgba(15,23,42,0.06);
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .scene-card header h2 { margin:0; }
    .scene-id { margin:0; font-size:0.9em; color:#557; }
    .scene-summary { margin:0; color:#455; }
    .scene-body p { margin:0 0 6px; }
    .scene-options ul { margin:6px 0 0 18px; }

    .raw-json pre {
      background:#0f172a;
      color:#f8fafc;
      padding:16px;
      border-radius:12px;
      overflow:auto;
    }
    .raw-json summary {
      cursor:pointer;
      font-weight:600;
      margin-bottom:8px;
    }
  </style>
{% endblock %}
