{% extends "base.html" %}
{% block content %}

<div class="passport-container">
  <h2>üéüÔ∏è Passport Progress</h2>
  <p class="stamp-counts">
    <strong>Your current stamps:</strong> {{ current_stamps }} <br>
  </p>

  {% if passports and passports|length > 0 %}
    <div class="passport-grid">
      {% for passport in passports %}
        <div class="passport-card">
          <div class="passport-slots">
            {% for i in range(12) %}
              {% if i < passport|length %}
                <div class="stamp-slot filled {% if passport[i].is_new %}new-stamp{% endif %}">
                  <img src="{{ passport[i].icon }}" alt="{{ passport[i].name }}">
                  <p class="stamp-label" title="{{ passport[i].name }}">
                    {{ passport[i].name }}
                  </p>
                  {% if passport[i].is_new %}
                    <div class="stamper">
                      <img src="{{ url_for('static', filename='passport/stampbot.png') }}" class="stampbot">
                      <img src="{{ url_for('static', filename='passport/stamptop.png') }}" class="stamptop">
                    </div>
                  {% endif %}
                </div>
              {% else %}
                <div class="stamp-slot empty">
                  <div class="pokeball-placeholder"></div>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="no-stamps">You don‚Äôt have any stamps yet. Check in at events to earn them!</p>
  {% endif %}

  <div style="margin-top:20px; text-align:center;">
    <a href="{{ url_for('dashboard') }}" class="btn">‚¨Ö Back to Dashboard</a>
  </div>
</div>

<style>
/* Burst effect */
.new-stamp {
  position: relative;
}
.new-stamp.animate::after {
  content: "";
  position: absolute;
  top: 50%;
  left: 50%;
  width: 140px;
  height: 140px;
  background: radial-gradient(circle, rgba(0,136,255,0.6), transparent 70%);
  border-radius: 50%;
  transform: translate(-50%, -50%) scale(0);
  animation: burst 1s ease-out forwards;
  z-index: -1;
}

@keyframes burst {
  to { transform: translate(-50%, -50%) scale(1); opacity: 0; }
}

/* Stamper tool */
.stamper {
  position: absolute;
  top: -40px;
  left: 50%;
  transform: translateX(-50%);
  opacity: 0;
  pointer-events: none;
}

.stampbot,
.stamptop {
  width: 80px;
  display: block;
  margin: 0 auto;
  position: relative;
}

.new-stamp.animate .stamper {
  animation: stamper-sequence 1.5s ease-out forwards;
}

@keyframes stamper-sequence {
  0%   { opacity: 0; transform: translate(-50%, -60px) scale(1); }
  20%  { opacity: 1; transform: translate(-50%, -20px) scale(1.05); }
  50%  { opacity: 1; transform: translate(-50%, 0px) scale(1); }
  80%  { opacity: 1; transform: translate(-50%, 0px) scale(1); }
  100% { opacity: 0; transform: translate(-50%, -60px) scale(0.9); }
}
</style>

<script>
window.addEventListener("load", () => {
  const newStamp = document.querySelector(".stamp-slot.new-stamp");
  if (newStamp) {
    setTimeout(() => {
      newStamp.classList.add("animate");
    }, 3000); // delay burst + stamper until after loading screen
  }
});
</script>

{% endblock %}