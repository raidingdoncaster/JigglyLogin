{% extends "base.html" %}
{% block content %}

<h1>ğŸ {{ item.name }}</h1>

<div class="item-detail">
  <div class="left" style="background-image:url('{{ item.image_url or url_for('static', filename='icons/catalog-app.png') }}');"></div>
  <div class="right">
    <p class="desc">{{ item.description or 'No description provided.' }}</p>
    <div class="row">
      <span class="pill">ğŸª™ {{ item.cost_stamps }} stamps</span>
      <span class="pill {{ 'low' if (item.stock or 0) <= 3 else '' }}">ğŸ“¦ {{ item.stock }} in stock</span>
    </div>
    {% if item.tags and item.tags|length %}
    <div class="tags" style="margin-top:8px;">
      {% for t in item.tags %}
      <span class="tag">#{{ t }}</span>
      {% endfor %}
    </div>
    {% endif %}

    <div class="actions">
      {% set can_redeem = (item.active and (item.stock or 0) > 0) %}
      {% if can_redeem %}
          <a href="{{ url_for('catalog_redeem', item_id=item.id) }}" class="primary">Redeem</a>
      {% else %}
          <button disabled title="Unavailable">Unavailable</button>
      {% endif %}
      <button id="watchBtn" class="secondary">
        {% if item.id in watch_ids %}ğŸ”­ Remove from Watchlist{% else %}ğŸ”­ Add to Watchlist{% endif %}
      </button>
      <a href="{{ url_for('catalog') }}" class="secondary">â¬… Back to Catalog</a>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("watchBtn");
  if (btn) {
    btn.addEventListener("click", () => {
      fetch(`/watchlist/toggle/{{ item.id }}`, {method: "POST"})
        .then(r => r.json())
        .then(data => {
          if (data.success) {
            btn.textContent = data.watched ? "ğŸ”­ Remove from Watchlist" : "ğŸ”­ Add to Watchlist";
          }
        });
    });
  }
});
</script>

<style>
.item-detail{ display:grid; grid-template-columns:1fr; gap:12px; }
@media(min-width:560px){ .item-detail{ grid-template-columns:1.1fr 1.2fr; } }
.left{ width:100%; height:220px; background:#eef3f8 center/cover no-repeat; border-radius:12px; }
.right .desc{ color:#444; }
.pill{ background:#f4f7fa; border-radius:999px; padding:3px 8px; font-size:.9em; margin-right:6px; }
.pill.low{ background:#fff5f5; color:#b91c1c; }
.tag{ font-size:.8em; background:#f4f4f5; padding:3px 6px; border-radius:6px; margin-right:6px; }
.actions{ margin-top:14px; display:flex; gap:8px; flex-wrap:wrap; }
.actions button, .actions a{ text-decoration:none; background:#eef2ff; color:#3a8dde; padding:8px 12px; border-radius:8px; font-weight:700; border:none; cursor:pointer; }
.actions .primary{ background:#3a8dde; color:#fff; }
.actions button[disabled]{ opacity:.6; cursor:not-allowed; }
</style>

{% endblock %}