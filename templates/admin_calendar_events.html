{% extends "base.html" %}

{% block page_settings %}
  {% set container_class = 'is-wide' %}
{% endblock %}

{% block content %}
<div class="calendar-admin">
  <header class="calendar-admin__header">
    <h1>üóìÔ∏è Calendar Events</h1>
    <p>Add quick one-off meetups to the public calendar without touching Supabase.</p>
  </header>

  <section class="calendar-admin__form">
    <h2>Add a Calendar Event</h2>
    <form method="post" class="calendar-form">
      <div class="field">
        <label for="name">Event title</label>
        <input type="text" id="name" name="name" required placeholder="Community Raid Night">
      </div>

      <div class="field-grid">
        <div class="field">
          <label for="start_datetime">Start (UK time)</label>
          <input type="datetime-local" id="start_datetime" name="start_datetime" required>
        </div>
        <div class="field">
          <label for="end_datetime">End (UK time)</label>
          <input type="datetime-local" id="end_datetime" name="end_datetime">
          <small>Optional ‚Äì defaults to 2 hours after start.</small>
        </div>
      </div>

      <div class="field-grid">
        <div class="field">
          <label for="location">Location</label>
          <input type="text" id="location" name="location" placeholder="Doncaster Wool Market">
        </div>
        <div class="field">
          <label for="campfire_url">Campfire link</label>
          <input type="url" id="campfire_url" name="campfire_url" placeholder="https://campfire.nianticlabs.com/...">
        </div>
      </div>

      <div class="field">
        <label for="cover_photo_url">Cover image URL</label>
        <input type="url" id="cover_photo_url" name="cover_photo_url" placeholder="https://example.com/banner.jpg">
        <small>Optional ‚Äì appears in the calendar detail pane.</small>
      </div>

      <button type="submit" class="btn">Add to calendar</button>
    </form>
  </section>

  <section class="calendar-admin__list">
    <h2>Current Custom Events</h2>
    {% if has_events %}
      <div class="event-table">
        <div class="event-table__head">
          <span>Event</span>
          <span>When</span>
          <span>Links</span>
          <span></span>
        </div>
        {% for ev in custom_events %}
          <div class="event-row">
            <div>
              <strong>{{ ev.name }}</strong>
              {% if ev.location %}
                <div class="muted">{{ ev.location }}</div>
              {% endif %}
            </div>
            <div>
              <span>{{ ev.start_display }}</span>
              <span class="muted">Ends {{ ev.end_display }}</span>
            </div>
            <div class="event-row__links">
              {% if ev.campfire_url %}
                <a href="{{ ev.campfire_url }}" target="_blank" rel="noopener">Campfire ‚Üó</a>
              {% else %}
                <span class="muted">No link</span>
              {% endif %}
              <a href="{{ url_for('event_ics_file', event_id=ev.event_id) }}">Download .ics</a>
            </div>
            <div class="event-row__actions">
              <form method="post" action="{{ url_for('admin_calendar_events_delete', event_id=ev.event_id) }}" onsubmit="return confirm('Remove {{ ev.name }} from the calendar?');">
                <button type="submit" class="btn-danger">Delete</button>
              </form>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="muted">No custom events yet. Use the form above to add your first listing.</p>
    {% endif %}
  </section>
</div>

<style>
.calendar-admin { display:flex; flex-direction:column; gap:24px; }
.calendar-admin__header h1 { margin:0; }
.calendar-admin__header p { margin:6px 0 0; color:#4b5563; }
.calendar-admin__form, .calendar-admin__list {
  background:#fff;
  border-radius:18px;
  padding:20px;
  box-shadow:0 12px 24px rgba(15,23,42,0.12);
}
.calendar-admin__form h2,
.calendar-admin__list h2 { margin-top:0; }
.calendar-form { display:flex; flex-direction:column; gap:18px; }
.field { display:flex; flex-direction:column; gap:8px; }
.field label { font-weight:600; color:#1f2937; }
.field input { padding:10px 12px; border:1px solid #d1d5db; border-radius:10px; font-size:0.95rem; }
.field input:focus { outline:none; border-color:#3a8dde; box-shadow:0 0 0 3px rgba(58,141,222,0.2); }
.field small { font-size:0.8rem; color:#6b7280; }
.field-grid { display:grid; gap:16px; grid-template-columns:repeat(2,minmax(0,1fr)); }
.btn { align-self:flex-start; padding:10px 18px; border-radius:999px; background:#3a8dde; color:#fff; font-weight:600; border:none; cursor:pointer; box-shadow:0 8px 18px rgba(58,141,222,0.25); }
.btn:hover { transform:translateY(-1px); }
.btn-danger { padding:8px 16px; border-radius:999px; background:#ef4444; color:#fff; border:none; cursor:pointer; font-weight:600; }
.btn-danger:hover { background:#dc2626; }
.event-table { display:flex; flex-direction:column; gap:12px; }
.event-table__head { display:grid; grid-template-columns:2fr 2fr 1.5fr auto; font-weight:600; color:#1f2937; font-size:0.9rem; }
.event-row { display:grid; grid-template-columns:2fr 2fr 1.5fr auto; align-items:center; background:#f8fafc; border-radius:14px; padding:12px 16px; gap:12px; }
.event-row strong { display:block; font-size:1rem; }
.event-row__links { display:flex; flex-direction:column; gap:4px; font-size:0.9rem; }
.event-row__links a { color:#2563eb; text-decoration:none; font-weight:600; }
.event-row__links a:hover { text-decoration:underline; }
.event-row__actions form { margin:0; }
.muted { color:#6b7280; font-size:0.85rem; }
@media(max-width:820px){
  .field-grid { grid-template-columns:1fr; }
  .event-table__head, .event-row {
    grid-template-columns:1fr;
    align-items:flex-start;
  }
  .event-row { gap:8px; }
  .event-row__actions { display:flex; justify-content:flex-start; }
}
</style>
{% endblock %}
