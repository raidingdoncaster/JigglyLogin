{% extends "base.html" %}

{% block page_settings %}
  {% set container_class = 'is-wide' %}
{% endblock %}

{% block content %}

<section class="admin-leagues-hero">
  <div class="hero-overlay"></div>
  <div class="hero-content">
    <div class="hero-copy">
      <h1>üèÜ Leagues Control Center</h1>
      <p>Coordinate CDL pipelines, PvP tournaments, and live event quests from a single hub. Review trainer profiles and keep tabs on live brackets in one place.</p>
      <div class="hero-actions">
        <a href="{{ url_for('admin_leagues_pvp') }}" class="btn-primary">Open PvP Tournament Manager</a>
      </div>
    </div>
    <div class="hero-highlights">
      <div class="highlight-card">
        <span class="highlight-label">League Profile</span>
        <p>Build a unified profile with standings, streaks, and reward history across every league.</p>
      </div>
      <div class="highlight-card">
        <span class="highlight-label">Live Ops</span>
        <p>Flip tournaments into live mode, manage brackets, and broadcast results in real time.</p>
      </div>
    </div>
  </div>
</section>

<section class="admin-leagues-grid">
  <article class="admin-card">
    <header class="admin-card__header">
      <div>
        <h2>League Profiles</h2>
        <p>Search for a trainer to inspect their league profile.</p>
      </div>
    </header>
    <form method="get" action="{{ url_for('admin_leagues') }}" class="search-form">
      <label for="trainer-search" class="sr-only">Search trainer username</label>
      <input
        id="trainer-search"
        type="text"
        name="q"
        value="{{ search_term }}"
        placeholder="Search trainer username"
        class="search-input"
      >
      <button type="submit" class="btn-secondary">Search</button>
    </form>
    {% if search_term %}
      <div class="search-feedback">
        <h3>Results for ‚Äú{{ search_term }}‚Äù</h3>
        {% if search_results %}
          <ul class="search-results">
            {% for trainer in search_results %}
              <li>
                <div>
                  <strong>{{ trainer.display_name }}</strong>
                  <p class="search-meta">{{ trainer.username }} ¬∑ {{ trainer.account_type }}</p>
                </div>
                <a class="btn-link" href="{{ url_for('leagues') }}?trainer={{ trainer.username }}">View Profile</a>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="search-empty">No trainers matched that search. Try another username.</p>
        {% endif %}
      </div>
    {% else %}
      <p class="search-hint">Tip: search by a trainer‚Äôs username to open their public league profile.</p>
    {% endif %}
  </article>

  <article class="admin-card">
    <header class="admin-card__header">
      <div>
        <h2>Live Ops</h2>
        <p>Monitor tournaments currently open for registration or live play.</p>
      </div>
    </header>
    {% if active_tournaments %}
      <ul class="tournament-list">
        {% for tournament in active_tournaments %}
          <li>
            <div class="tournament-info">
              <strong>{{ tournament.name }}</strong>
              <p class="tournament-meta">
                {{ tournament.bracket_type|replace('_', ' ')|title }}
                {% if tournament.start_at %}
                  ‚Ä¢ Starts {{ tournament.start_at.strftime('%d %b %Y %H:%M') }} UTC
                {% endif %}
              </p>
            </div>
            {% set status_key = tournament.status|lower %}
            <div class="tournament-actions">
              <span class="status-pill {{ 'status-pill--' ~ status_key if status_key in ['registration', 'live'] else 'status-pill--other' }}">{{ tournament.status|replace('_', ' ')|title }}</span>
              <a class="btn-link" href="{{ url_for('admin_leagues_pvp', tournament_id=tournament.id) }}">Manage</a>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="search-empty">No tournaments are in registration or live mode right now.</p>
    {% endif %}
  </article>
</section>

<style>
.admin-leagues-hero {
  position:relative;
  overflow:hidden;
  border-radius:20px;
  margin-bottom:22px;
  color:#fff;
}
.hero-overlay {
  position:absolute;
  inset:0;
  background:linear-gradient(135deg,#1e3a8a,#9333ea);
  opacity:0.92;
}
.hero-content {
  position:relative;
  z-index:1;
  display:flex;
  justify-content:space-between;
  gap:24px;
  padding:28px;
}
.hero-copy h1 {
  margin:0 0 8px;
}
.hero-copy p {
  margin:0 0 16px;
  max-width:520px;
}
.hero-actions {
  display:flex;
  gap:12px;
  flex-wrap:wrap;
}
.btn-primary,
.btn-secondary {
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:10px 18px;
  border-radius:12px;
  font-weight:600;
  text-decoration:none;
  transition:transform 0.15s ease;
  border:none;
  cursor:pointer;
}
.btn-primary {
  background:#facc15;
  color:#0f172a;
  box-shadow:0 12px 28px rgba(250,204,21,0.35);
}
.btn-secondary {
  background:rgba(15,23,42,0.25);
  color:#fff;
}
.btn-primary:hover,
.btn-secondary:hover {
  transform:translateY(-1px);
}
.hero-highlights {
  display:grid;
  gap:12px;
  min-width:260px;
}
.highlight-card {
  background:rgba(15,23,42,0.32);
  border-radius:14px;
  padding:16px;
  box-shadow:0 12px 24px rgba(15,23,42,0.35);
  display:flex;
  flex-direction:column;
  gap:6px;
}
.highlight-label {
  font-size:0.75em;
  text-transform:uppercase;
  letter-spacing:0.08em;
  color:rgba(255,255,255,0.75);
}
.admin-leagues-grid {
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:20px;
  margin-top:24px;
}
.admin-card {
  background:#fff;
  border-radius:18px;
  padding:24px;
  box-shadow:0 14px 32px rgba(15,23,42,0.12);
  display:flex;
  flex-direction:column;
  gap:18px;
}
.admin-card__header h2 {
  margin:0 0 6px;
}
.admin-card__header p {
  margin:0;
  color:#64748b;
}
.search-form {
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  align-items:center;
}
.search-input {
  flex:1;
  min-width:220px;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid #cbd5f5;
  font-weight:600;
  background:#f8fafc;
  color:#1f2937;
}
.search-input:focus {
  outline:3px solid rgba(59,130,246,0.25);
  border-color:#3b82f6;
  background:#fff;
}
.search-feedback h3 {
  margin:0 0 12px;
  font-size:1em;
  color:#1f2937;
}
.search-results {
  list-style:none;
  padding:0;
  margin:0;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.search-results li {
  display:flex;
  gap:16px;
  align-items:flex-start;
  justify-content:space-between;
  background:#f8fafc;
  border-radius:12px;
  padding:12px 14px;
  box-shadow:inset 0 0 0 1px rgba(148,163,184,0.18);
}
.search-meta {
  margin:4px 0 0;
  color:#64748b;
  font-size:0.85em;
}
.btn-link {
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:8px 12px;
  border-radius:999px;
  background:#2563eb;
  color:#fff;
  font-weight:600;
  text-decoration:none;
  min-width:110px;
  text-align:center;
  cursor:pointer;
}
.btn-link:hover {
  background:#1d4ed8;
}
.search-hint,
.search-empty {
  margin:0;
  color:#475569;
  font-size:0.9em;
}
.tournament-list {
  list-style:none;
  padding:0;
  margin:0;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.tournament-list li {
  display:flex;
  justify-content:space-between;
  gap:16px;
  align-items:flex-start;
  background:#f8fafc;
  border-radius:12px;
  padding:14px;
  box-shadow:inset 0 0 0 1px rgba(148,163,184,0.18);
}
.tournament-info strong {
  font-size:1em;
  color:#0f172a;
}
.tournament-meta {
  margin:4px 0 0;
  color:#475569;
  font-size:0.9em;
}
.tournament-actions {
  display:flex;
  align-items:center;
  gap:12px;
}
.status-pill {
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:6px 12px;
  border-radius:999px;
  font-size:0.75em;
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:0.05em;
}
.status-pill--registration {
  background:#fef3c7;
  color:#b45309;
}
.status-pill--live {
  background:#dcfce7;
  color:#166534;
}
.status-pill--other {
  background:#e2e8f0;
  color:#1f2937;
}
.sr-only {
  position:absolute;
  width:1px;
  height:1px;
  padding:0;
  margin:-1px;
  overflow:hidden;
  clip:rect(0,0,0,0);
  white-space:nowrap;
  border:0;
}

@media (max-width: 960px) {
  .admin-leagues-grid {
    grid-template-columns:repeat(1,minmax(0,1fr));
  }
}

@media (max-width: 640px) {
  .hero-content {
    flex-direction:column;
  }
  .hero-highlights {
    width:100%;
    grid-template-columns:repeat(1,minmax(0,1fr));
  }
}
</style>

{% endblock %}
