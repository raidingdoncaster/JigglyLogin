{% extends "base.html" %}

{% block page_settings %}
  {% set container_class = 'is-cozy' %}
{% endblock %}

{% block content %}
<div class="auth-shell">
  <section class="auth-hero auth-hero--login">
    <div class="hero-media">
      <img src="{{ url_for('static', filename='banner.jpg') }}" alt="Raiding Doncaster and Beyond" class="hero-banner">
    </div>
    <div class="hero-text">
      <span class="hero-eyebrow">Raiding Doncaster and Beyond</span>
      <h1>Where local Trainers level up together.</h1>
      <p>Sign in to track your passport stamps, unlock rewards, and stay in sync with Doncaster’s Pokémon GO community.</p>
    </div>
  </section>

  <style>
  .auth-hero--login{
    padding:26px 26px 28px;
    flex-direction:row;
    align-items:center;
    justify-content:space-between;
    gap:26px;
    min-height:auto;
  }
  .auth-hero--login .hero-glow{display:none;}
  .auth-hero--login .hero-media{
    flex:0 0 clamp(220px, 34%, 320px);
    display:flex;
    justify-content:center;
  }
  .auth-hero--login .hero-banner{
    display:block;
    width:100%;
    height:auto;
    max-width:320px;
    border-radius:18px;
    box-shadow:0 20px 48px rgba(15,23,42,0.32);
  }
  .auth-hero--login .hero-text{
    padding:0;
    gap:12px;
    max-width:420px;
  }
  .auth-hero--login .hero-eyebrow{
    font-size:0.64rem;
    letter-spacing:0.26em;
  }
  .auth-hero--login h1{
    font-size:1.45rem;
    line-height:1.22;
    margin:0;
  }
  .auth-hero--login p{
    font-size:0.95rem;
    line-height:1.5;
    color:rgba(226,232,240,0.92);
    margin:0;
  }
  .login-gowa-banner{margin-top:4px;}
  @media(max-width:840px){
    .auth-hero--login{
      padding:20px 22px 24px;
      gap:20px;
    }
    .auth-hero--login .hero-media{
      flex-basis: clamp(200px, 42%, 300px);
    }
    .auth-hero--login h1{
      font-size:1.32rem;
    }
  }
  @media(max-width:720px){
    .auth-hero--login{
      padding:0;
      flex-direction:column;
      align-items:stretch;
      gap:0;
    }
    .auth-hero--login .hero-media{
      width:100%;
      flex:0 0 auto;
    }
    .auth-hero--login .hero-banner{
      max-width:none;
      width:100%;
      border-radius:0;
      box-shadow:none;
    }
    .auth-hero--login .hero-text{
      padding:18px 20px 22px;
      max-width:none;
    }
  }
  @media(max-width:520px){
    .auth-hero--login .hero-text{
      padding:16px 18px 20px;
    }
    .auth-hero--login h1{
      font-size:1.18rem;
    }
    .auth-hero--login p{
      font-size:0.88rem;
    }
  }
  </style>

  <section class="auth-card">
    <h2>Welcome back</h2>
    <form action="{{ url_for('login') }}" method="post" class="auth-form">
      <label class="auth-label" for="login-username">Trainer Name</label>
      <input id="login-username" class="auth-input" type="text" name="username" placeholder="Exact Trainer Name" required>

      <label class="auth-label" for="login-pin">4-digit PIN</label>
      <div class="auth-input-row">
        <input id="login-pin" class="auth-input" type="password" name="pin" placeholder="Enter your PIN" pattern="\d{4}" maxlength="4" required>
        <button type="button" class="auth-btn auth-btn--outline" onclick="togglePin('login-pin', this)">Show</button>
      </div>

      <button type="submit" class="auth-btn auth-btn--primary auth-btn--full">Log in</button>
    </form>

    <div class="auth-tip" id="reminder-carousel">
      <span id="reminder-text">🔑 Never share your PIN or memorable password with anyone – admins will never ask for it.</span>
      <div id="pokeball-loader"></div>
    </div>

    <div class="auth-links">
      <a href="{{ url_for('signup') }}" class="auth-btn auth-btn--secondary">Create account</a>
      <a href="{{ url_for('recover') }}" class="auth-btn auth-btn--ghost">Forgot PIN?</a>
    </div>
  </section>

  <section class="policy-cta">
    <h3>Need the details?</h3>
    <p>Read how we protect trainers, manage prizes, and keep the RDAB app running safely.</p>
    <a href="{{ url_for('policies_index') }}?pwa=1&amp;source=login" class="auth-btn auth-btn--primary">View policies</a>
  </section>

  {% if gowa_banner %}
    <div class="login-gowa-banner gowa-banner-wrap">
      <a class="gowa-banner" href="{{ gowa_banner.href }}">
        <img src="{{ gowa_banner.image_url }}" alt="{{ gowa_banner.alt }}">
      </a>
    </div>
  {% endif %}
</div>

<script>
  let reminders = [
    "📱 Add the Raiding Doncaster and Beyond app to your homescreen! Just press the share button, then add to home!",
    "🎉 Every check-in brings you closer to rewards – don’t miss out!",
    "🔄 Forgot your PIN? Use the recovery option with your memorable password.",
    "✍️ Write down your memorable password somewhere safe so you don’t lose access.",
    "🎮 Remember: signing in here helps track your Passport stamps, check-ins, and prizes!"
  ];

  reminders = reminders
    .map(value => ({ value, sort: Math.random() }))
    .sort((a, b) => a.sort - b.sort)
    .map(({ value }) => value);

  let currentIndex = 0;
  const reminderElement = document.getElementById("reminder-text");
  const pokeball = document.getElementById("pokeball-loader");

  setInterval(() => {
    reminderElement.style.opacity = 0;
    setTimeout(() => {
      currentIndex = (currentIndex + 1) % reminders.length;
      reminderElement.textContent = reminders[currentIndex];
      reminderElement.style.opacity = 1;
      pokeball.classList.add("pop");
      setTimeout(() => pokeball.classList.remove("pop"), 300);
    }, 1000);
  }, 7000);
</script>
{% endblock %}
